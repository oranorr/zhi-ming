// ignore_for_file: public_member_api_docs, sort_constructors_first
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_screenutil/flutter_screenutil.dart';
import 'package:flutter_svg/svg.dart';
import 'package:zhi_ming/core/extensions/build_context_extension.dart';
import 'package:zhi_ming/features/adapty/data/repositories/adapty_repository_impl.dart';
import 'package:zhi_ming/core/theme/theme_colors.dart';
import 'package:zhi_ming/core/widgets/z_button.dart';
import 'package:zhi_ming/features/adapty/domain/models/subscription_product.dart';
import 'package:zhi_ming/features/home/presentation/home_screen.dart';

/// –û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥–∂–µ—Ç –ø–µ–π–≤–æ–ª–ª–∞ (—ç–∫—Ä–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏)
///
/// **–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏:**
/// - –ü—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ AdaptyRepositoryImpl
/// - –ù–∞ –ø–µ–π–≤–æ–ª–ª–µ –Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ - —Ç–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
/// - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω–≥–ª—Ç–æ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
///
/// **Apple HIG Design –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
/// - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π gradient–Ω—ã–π —Ñ–æ–Ω —Å –ø–ª–∞–≤–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
/// - –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –¥–∏–∑–∞–π–Ω –≤ —Å—Ç–∏–ª–µ macOS
/// - –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫
/// - –ß–µ—Ç–∫–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
class Paywall extends StatefulWidget {
  const Paywall({super.key});

  @override
  State<Paywall> createState() => _PaywallState();
}

/// –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–µ–π–≤–æ–ª–ª–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º —Ñ–æ–Ω–æ–º
///
/// **–î–∏–∑–∞–π–Ω —Ä–µ—à–µ–Ω–∏—è:**
/// - –ò—Å–ø–æ–ª—å–∑—É–µ–º Stack –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ Apple HIG
/// - –î–≤–æ–π–Ω–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–∏–¥
/// - –¶–≤–µ—Ç–∞ –ø–æ–¥–æ–±—Ä–∞–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è premium –æ—â—É—â–µ–Ω–∏—è
class _PaywallState extends State<Paywall> with SingleTickerProviderStateMixin {
  /// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏–∞–º–∏
  /// (–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –≥–æ—Ç–æ–≤ –¥–ª—è –±—É–¥—É—â–∏—Ö –∞–Ω–∏–º–∞—Ü–∏–π)
  late AnimationController _animationController;

  @override
  void initState() {
    super.initState();
    // [Paywall] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –Ω–µ –Ω—É–∂–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–∏—Å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π
  }

  @override
  Widget build(BuildContext context) {
    return const Scaffold(
      body: Center(
        child: Stack(
          alignment: Alignment.center,
          children: [
            // **–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç–Ω–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç**
            // –°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–π —Ñ–æ–Ω —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –æ—Ç –∑–µ–ª–µ–Ω–æ–≥–æ –∫ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–º—É
            // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç 4 —Ü–≤–µ—Ç–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
            DecoratedBox(
              decoration: BoxDecoration(
                gradient: LinearGradient(
                  begin: Alignment.topCenter,
                  end: Alignment.bottomCenter,
                  colors: [
                    Color(0xFFEDFFCC), // —Å–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π (–ø—Ä–∏—Ä–æ–¥–Ω—ã–µ —Ç–æ–Ω–∞)
                    Color(0xFFEEEFFF), // —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ)
                    Color(0xFFD6A0EA), // —Ä–æ–∑–æ–≤–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (—ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å)
                    Color(0xFFA6AAFE), // –≥–æ–ª—É–±–æ–≤–∞—Ç–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (–¥–æ–≤–µ—Ä–∏–µ)
                  ],
                  stops: [0.0, 0.32, 0.57, 1.0],
                ),
              ),
              child: SizedBox.expand(),
            ),
            // **–ë–µ–ª—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –ø–æ–≤–µ—Ä—Ö –¥–ª—è —Å–æ—Ñ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∞**
            // –î–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –º—è–≥–∫–æ—Å—Ç—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç—É
            // –°–æ–≥–ª–∞—Å–Ω–æ Apple HIG - –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º —Ö–æ—Ä–æ—à–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç
            Opacity(
              opacity: 0.42,
              child: DecoratedBox(
                decoration: BoxDecoration(
                  gradient: LinearGradient(
                    begin: Alignment.topCenter,
                    end: Alignment.bottomCenter,
                    colors: [
                      Color(0xffF2F2F2), // —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
                      Color(0xffFFFFFF), // –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –±–µ–ª—ã–π
                    ],
                    stops: [0.0, 0.42],
                  ),
                ),
              ),
            ),
            // –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ–π–≤–æ–ª–ª–∞
            _PaywallBody(),
          ],
        ),
      ),
    );
  }
}

/// –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ–π–≤–æ–ª–ª–∞ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
///
/// **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
/// –≠—Ç–æ—Ç –≤–∏–¥–∂–µ—Ç –±–æ–ª—å—à–µ –Ω–µ –∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤,
/// —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
/// –≤ —Å–∏–Ω–≥–ª—Ç–æ–Ω–µ AdaptyRepositoryImpl
class _PaywallBody extends StatefulWidget {
  const _PaywallBody();

  @override
  State<_PaywallBody> createState() => __PaywallBodyState();
}

/// –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–ª–∞ –ø–µ–π–≤–æ–ª–ª–∞ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º UI/UX
///
/// **–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:**
/// - ‚ùå isLoading - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ, –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –∫—ç—à–∞
/// - ‚úÖ products - –≥–µ—Ç—Ç–µ—Ä –∏–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
/// - ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UI –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
///
/// **Apple HIG –¥–∏–∑–∞–π–Ω –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–µ –∑–¥–µ—Å—å:**
/// - –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π
/// - –•—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/// - –ß–µ—Ç–∫–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –≤–∞–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
/// - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
/// - Accessibility –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞
class __PaywallBodyState extends State<_PaywallBody>
    with TickerProviderStateMixin {
  /// –°–∏–Ω–≥–ª—Ç–æ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ–¥—É–∫—Ç–∞–º
  /// –¢–µ–ø–µ—Ä—å —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  static final repository = AdaptyRepositoryImpl.instance;

  /// –ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–≤—ã–π)
  /// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞–∫–æ–π –ø—Ä–æ–¥—É–∫—Ç –ø–æ–∫—É–ø–∞—Ç—å
  int selectedPlanIndex = 0;

  /// –§–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è
  /// –ü—Ä–∏ true –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
  bool isSuccess = false;

  /// ‚ùå –£–î–ê–õ–ï–ù–û: isLoading - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é
  /// –ü—Ä–æ–¥—É–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞

  /// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–∫—É–ø–∫–∏ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
  /// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–≤–µ—Ä–ª–µ–π —Å –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
  bool isPurchasing = false;

  /// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫
  /// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø–æ–∫—É–ø–∫–µ, –Ω–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
  bool isRestoring = false;

  /// –ì–µ—Ç—Ç–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  /// **–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**
  /// –í–º–µ—Å—Ç–æ List<SubscriptionProduct> products = []
  /// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –≥–µ—Ç—Ç–µ—Ä –∏–∑ —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞ - –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  List<SubscriptionProduct> get products => repository.cachedProducts;

  /// –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  /// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  String purchaseStatusText = '';

  /// **–ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–º–∏—É–º UX (Apple HIG):**
  /// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—É–ª—å—Å–∞—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
  /// –°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π feedback –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  late AnimationController _pulseController;
  late Animation<double> _pulseAnimation;

  @override
  void initState() {
    super.initState();

    /// **–†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï:**
    /// –ë–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ–º _loadProducts() - –ø—Ä–æ–¥—É–∫—Ç—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!
    /// –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç UX - –Ω–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫, –Ω–µ—Ç —Å–∫–µ–ª–µ—Ç–æ–Ω–æ–≤

    /// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—É–ª—å—Å–∞—Ü–∏–∏ –¥–ª—è premium —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    /// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è engaging –æ–ø—ã—Ç–∞
    _pulseController = AnimationController(
      duration: const Duration(milliseconds: 1000),
      vsync: this,
    );
    _pulseAnimation = Tween<double>(begin: 0.8, end: 1.2).animate(
      CurvedAnimation(parent: _pulseController, curve: Curves.easeInOut),
    );

    /// –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫—ç—à–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    /// –ü–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –±—ã–ª–∏ –ª–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (!repository.areProductsLoaded) {
      debugPrint(
        '[PaywallBody] ‚ö†Ô∏è –ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –±—ã–ª–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏',
      );
    } else {
      debugPrint(
        '[PaywallBody] ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º ${products.length} –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
      );
    }
  }

  @override
  void dispose() {
    /// –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –≤–∏–¥–∂–µ—Ç–∞
    /// –í–∞–∂–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
    _pulseController.dispose();
    super.dispose();
  }

  Widget _buildLoadingOverlay() {
    /// –ï—Å–ª–∏ –Ω–µ –ø–æ–∫—É–ø–∞–µ–º –∏ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
    if (!isPurchasing && !isRestoring) return const SizedBox.shrink();

    return ColoredBox(
      /// –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
      /// 50% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤–∏–¥–∏–º–æ—Å—Ç–∏
      color: Colors.black.withOpacity(0.5),
      child: Center(
        child: Container(
          /// –†–∞–∑–º–µ—Ä—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
          /// –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –¥–ª—è –∏–∫–æ–Ω–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏—è
          width: 280.w,
          height: 180.h,
          decoration: BoxDecoration(
            /// –ë–µ–ª—ã–π —Ñ–æ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç
            color: Colors.white,

            /// 20px —Ä–∞–¥–∏—É—Å = —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π macOS —Å—Ç–∏–ª—å
            borderRadius: BorderRadius.circular(20.r),
            boxShadow: [
              /// –ú—è–≥–∫–∞—è —Ç–µ–Ω—å —Å–æ–∑–¥–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ "–ø–∞—Ä–µ–Ω–∏—è" –Ω–∞–¥ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
              /// 10% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —á–µ—Ä–Ω–æ–≥–æ + —Å–º–µ—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞—é—Ç –≥–ª—É–±–∏–Ω—É
              BoxShadow(
                color: Colors.black.withOpacity(0.1),
                blurRadius: 20,
                offset: const Offset(0, 10),
              ),
            ],
          ),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              /// **–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏**
              /// –ü—É–ª—å—Å–∏—Ä—É—é—â–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç premium –æ—â—É—â–µ–Ω–∏—è
              /// AnimatedBuilder –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
              AnimatedBuilder(
                animation: _pulseAnimation,
                builder: (context, child) {
                  return Transform.scale(
                    scale: _pulseAnimation.value,
                    child: Container(
                      width: 60.w,
                      height: 60.h,
                      decoration: BoxDecoration(
                        /// –§–æ–Ω–æ–≤—ã–π –∫—Ä—É–≥ —Å —Ü–≤–µ—Ç–æ–º –∞–∫—Ü–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                        /// 10% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–µ—Ç –º—è–≥–∫–∏–π –æ—Ä–µ–æ–ª
                        color: const Color(0xFF6B73FF).withOpacity(0.1),
                        shape: BoxShape.circle,
                      ),
                      child: const CircularProgressIndicator(
                        /// –¶–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                        /// –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—É—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
                        valueColor: AlwaysStoppedAnimation<Color>(
                          Color(0xFF6B73FF),
                        ),
                        strokeWidth: 3,
                      ),
                    ),
                  );
                },
              ),
              SizedBox(height: 24.h),

              /// **–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—É—Å–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π)**
              /// –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —ç—Ç–∞–ø–∞ –ø–æ–∫—É–ø–∫–∏
              Text(
                purchaseStatusText,
                style: context.styles.h3.copyWith(fontWeight: FontWeight.w600),
                textAlign: TextAlign.center,
              ),
              SizedBox(height: 8.h),

              /// **–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ)**
              /// –î–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω–∏–º–∞–Ω–∏–µ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
              Text(
                isPurchasing ? 'ËØ∑Á®çÁ≠âÔºåÊ≠£Âú®Â§ÑÁêÜÊÇ®ÁöÑË¥≠‰π∞...' : 'Ê≠£Âú®ÊÅ¢Â§çÊÇ®ÁöÑË¥≠‰π∞...',
                style: context.styles.mRegular.copyWith(
                  color: Colors.grey.shade600,
                ),
                textAlign: TextAlign.center,
              ),
            ],
          ),
        ),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    /// **–≠–∫—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ —Å premium –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ - –ê–î–ê–ü–¢–ò–í–ù–ê–Ø –í–ï–†–°–ò–Ø**
    /// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ isSuccess = true
    ///
    /// **Apple HIG –ø—Ä–µ–º–∏—É–º –æ–ø—ã—Ç:**
    /// - –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –¥–ª—è –ø—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏—è
    /// - –ë–æ–ª—å—à–∞—è –≥–∞–ª–æ—á–∫–∞ –∫–∞–∫ —Å–∏–º–≤–æ–ª —É—Å–ø–µ—Ö–∞
    /// - –ß–µ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö
    /// - –ü—Ä–æ—Å—Ç–∞—è –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
    ///
    /// **üéØ –ê–î–ê–ü–¢–ò–í–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:**
    /// - SafeArea –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
    /// - Column —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
    /// - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ ScreenUtil
    /// - Flexible –≤–∏–¥–∂–µ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–æ–≤
    if (isSuccess) {
      return Scaffold(
        backgroundColor: Colors.transparent,
        body: SafeArea(
          child: Column(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              /// **–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∫–æ–Ω—Ñ–µ—Ç—Ç–∏**
              /// –ê–¥–∞–ø—Ç–∏–≤–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
              Flexible(
                flex: 2,
                child: Stack(
                  alignment: Alignment.topCenter,
                  children: [
                    /// –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                    Positioned(
                      top: 30.h, // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è —Å–≤–µ—Ä—Ö—É
                      left: 0,
                      right: 0,
                      child: Image.asset('assets/confetty.png'),
                    ),
                  ],
                ),
              ),

              /// **–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º**
              /// –ó–∞–Ω–∏–º–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —ç–∫—Ä–∞–Ω–∞
              Flexible(
                flex: 3,
                child: Padding(
                  padding: EdgeInsets.symmetric(horizontal: 20.w),
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      /// –ë–æ–ª—å—à–∞—è –∏–∫–æ–Ω–∫–∞ –≥–∞–ª–æ—á–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                      /// –ú–µ–Ω—å—à–µ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
                      SizedBox(
                        width: 140.w, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å–æ 170.w –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
                        height: 140.h, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å–æ 170.h –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
                        child: Image.asset('assets/big_check.png'),
                      ),
                      SizedBox(height: 24.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 36.h
                      /// –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏
                      Text(
                        'ÊÇ®ÁöÑË¥≠‰π∞Â∑≤ÊàêÂäüÂÆåÊàêÔºÅ',
                        style: context.styles.h2,
                        textAlign: TextAlign.center,
                      ),
                      SizedBox(height: 8.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 12.h
                      /// –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ VIP –ø–æ–¥–ø–∏—Å–∫–∏
                      /// –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ç–æ–º, —á—Ç–æ –æ–Ω –ø–æ–ª—É—á–∏–ª
                      Text(
                        'ÊÅ≠ÂñúÊÇ®Ëé∑ÂæóVIP‰∏ìÂ±ûÊùÉÈôêÔºåÂèØÊü•Áúã‰∏™‰∫∫ÂÖ´Â≠óÂëΩÁõòÂíåÊ∑±Â∫¶ËøêÂäøÂàÜÊûêÔºÅ',
                        style: context.styles.h2,
                        textAlign: TextAlign.center,
                      ),
                    ],
                  ),
                ),
              ),

              /// **–ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Å –∫–Ω–æ–ø–∫–æ–π**
              /// –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–Ω–∏–∑—É —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
              Flexible(
                child: Padding(
                  padding: EdgeInsets.all(20.w),
                  child: Zbutton(
                    action: () async {
                      /// –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π —ç–∫—Ä–∞–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏
                      /// –û—á–∏—â–∞–µ–º –≤–µ—Å—å —Å—Ç–µ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —á–∏—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                      await Navigator.of(context).pushAndRemoveUntil(
                        MaterialPageRoute(
                          builder: (context) => const HomeScreen(),
                        ),
                        (route) => false,
                      );
                    },
                    isLoading: false,
                    isActive: true,
                    text: 'ÂÆåÊàê',
                    textColor: Colors.white,
                  ),
                ),
              ),
            ],
          ),
        ),
      );
    }

    /// **–û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° –ü–ï–ô–í–û–õ–õ–ê - –ê–î–ê–ü–¢–ò–í–ù–´–ô –î–ò–ó–ê–ô–ù**
    ///
    /// **–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∑–∞–≥—Ä—É–∑–∫–∏:**
    /// - ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –∫—ç—à–∞
    /// - ‚ùå –ù–µ—Ç isLoading –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    /// - ‚ùå –ù–µ—Ç —Å–∫–µ–ª–µ—Ç–æ–Ω —ç–∫—Ä–∞–Ω–æ–≤
    /// - ‚úÖ –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –∞–Ω–∏–º–∞—Ü–∏–∏
    ///
    /// **üéØ –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ë–ï–ó –°–ö–†–û–õ–õ–ê:**
    /// - –ò—Å–ø–æ–ª—å–∑—É–µ–º SafeArea –¥–ª—è —É—á–µ—Ç–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
    /// - Column —Å MainAxisAlignment.spaceBetween –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    /// - Flexible –≤–∏–¥–∂–µ—Ç—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —ç–∫—Ä–∞–Ω–æ–≤
    /// - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —á–µ—Ä–µ–∑ ScreenUtil (.w/.h)
    /// - –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–º–µ—â–∞—é—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞
    ///
    /// **Apple HIG UX –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
    /// - AbsorbPointer –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
    /// - Opacity —Å–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π feedback –æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    /// - Stack –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–ª–æ–∂–∏—Ç—å loading overlay –ø–æ–≤–µ—Ä—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    return Stack(
      children: [
        /// **–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ–π–≤–æ–ª–ª–∞ - –ê–î–ê–ü–¢–ò–í–ù–´–ô LAYOUT**
        /// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è UX
        AbsorbPointer(
          absorbing:
              isPurchasing ||
              isRestoring, // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
          child: Opacity(
            opacity:
                isPurchasing || isRestoring ? 0.5 : 1.0, // –ó–∞—Ç–µ–º–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            child: SafeArea(
              /// **SafeArea –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö**
              /// –≤–∫–ª—é—á–∞—è iPhone —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –æ—Å—Ç—Ä–æ–≤–æ–º, Android —Å –≤—ã—Ä–µ–∑–∞–º–∏
              child: Padding(
                padding: EdgeInsets.symmetric(horizontal: 20.w),

                /// **üöÄ –ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: Column –≤–º–µ—Å—Ç–æ SingleChildScrollView**
                /// –¢–µ–ø–µ—Ä—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ —ç–∫—Ä–∞–Ω—É –∞–¥–∞–ø—Ç–∏–≤–Ω–æ
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  crossAxisAlignment: CrossAxisAlignment.stretch,
                  children: [
                    /// **üì± –í–ï–†–•–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–∫–æ–Ω–∫–∏**
                    /// –ó–∞–Ω–∏–º–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
                    _buildTopSection(),

                    /// **üîß –°–†–ï–î–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –ø–ª–∞–Ω—ã**
                    /// –†–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —ç–∫—Ä–∞–Ω–∞
                    Expanded(child: _buildMiddleSection()),

                    /// **üí≥ –ù–ò–ñ–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ö–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏**
                    /// –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–Ω–∏–∑—É —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
                    _buildBottomSection(),
                  ],
                ),
              ),
            ),
          ),
        ),
        // –û–≤–µ—Ä–ª–µ–π —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        _buildLoadingOverlay(),
      ],
    );
  }

  /// **üì± –í–ï–†–•–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–∫–æ–Ω–∫–∏**
  ///
  /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
  /// - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
  /// - –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ —Å—Ç–∏–ª–µ macOS
  /// - –ò–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
  /// - –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–æ–π
  Widget _buildTopSection() {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.stretch,
      mainAxisSize: MainAxisSize.min,
      children: [
        /// **–û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π**
        /// –ù–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –±–æ–ª—å—à–µ, –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö - –º–µ–Ω—å—à–µ
        // SizedBox(height: .h),

        /// **–ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤ —Å—Ç–∏–ª–µ macOS**
        /// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞
        Row(
          children: [
            IconButton(
              onPressed: () async {
                /// –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –≤–æ –≤—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
                /// –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–∫—É–ø–∫–∏
                if (isPurchasing || isRestoring) return;

                /// –ó–∞–∫—Ä—ã—Ç–∏–µ paywall –∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π —ç–∫—Ä–∞–Ω
                /// –û—á–∏—â–∞–µ–º —Å—Ç–µ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
                await Navigator.of(context).pushAndRemoveUntil(
                  MaterialPageRoute(builder: (context) => const HomeScreen()),
                  (route) => false,
                );
              },
              icon: Icon(
                Icons.close,
                size: 28.sp, // –ò—Å–ø–æ–ª—å–∑—É–µ–º .sp –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–∫–æ–Ω–∫–∏
                color: isPurchasing || isRestoring ? Colors.grey : Colors.black,
              ),
              padding: EdgeInsets.zero,
              style: IconButton.styleFrom(padding: EdgeInsets.zero),
            ),
          ],
        ),

        /// **–û—Å–Ω–æ–≤–Ω–∞—è –∏–∫–æ–Ω–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã**
        /// –£–º–µ–Ω—å—à–µ–Ω—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
        Center(
          child: SizedBox(
            height: 80.h, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 114.h –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
            width: 78.w, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 111.w –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
            child: Image.asset('assets/heads.png'),
          ),
        ),
        SizedBox(height: 12.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 18.h
        /// **–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ–π–≤–æ–ª–ª–∞ - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π**
        /// –ò–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
        Text('ÊÇ®ÁöÑÂç†ÂçúÂ∑≤ÁªìÊùü', style: context.styles.h2, textAlign: TextAlign.center),
        SizedBox(height: 4.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 6.h
        /// **–ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π**
        /// –ú–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –∫ –ø–æ–∫—É–ø–∫–µ VIP –ø–æ–¥–ø–∏—Å–∫–∏
        Text(
          'ÂçáÁ∫ßVIPÔºåÁïÖ‰∫´ÂÖ®ÈÉ®ÂäüËÉΩ',
          style: context.styles.h2,
          textAlign: TextAlign.center,
        ),
      ],
    );
  }

  /// **üîß –°–†–ï–î–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –ø–ª–∞–Ω—ã**
  ///
  /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
  /// - –ò—Å–ø–æ–ª—å–∑—É–µ–º SingleChildScrollView —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏
  /// - Flexible height –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
  /// - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –ø–æ–º–µ—â–µ–Ω–∏—è –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  /// - –°–ø–∏—Å–æ–∫ –ø–ª–∞–Ω–æ–≤ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
  Widget _buildMiddleSection() {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 5.h), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        mainAxisSize: MainAxisSize.min,
        children: [
          /// –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ VIP
          Text('Ë¶ÅÁªßÁª≠Âπ∂‰∫ÜËß£Êõ¥Â§öÔºö', style: context.styles.mRegular),
          SizedBox(height: 8.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10.h
          /// **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ VIP - –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –í–ï–†–°–ò–Ø**
          ///
          /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
          /// - –£–º–µ–Ω—å—à–µ–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏–∫–æ–Ω–æ–∫ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
          /// - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
          /// - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
          ..._buildAdvantages(),
          SizedBox(height: 20.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 32.h
          /// **–ö–õ–Æ–ß–ï–í–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –ê–†–•–ò–¢–ï–ö–¢–£–†–´:**
          /// –ë–æ–ª—å—à–µ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ isLoading!
          /// –ü—Ä–æ–¥—É–∫—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫—ç—à–∞
          if (products.isEmpty)
            Text(
              'ÊöÇÊó†ÂèØÁî®Â•óÈ§ê',
              style: context.styles.mRegular.copyWith(color: Colors.grey),
              textAlign: TextAlign.center,
            )
          else
            /// **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞–Ω–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏ - –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –í–ï–†–°–ò–Ø**
            ///
            /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
            /// - –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏
            /// - –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
            /// - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
            ..._buildPlans(),
        ],
      ),
    );
  }

  /// **üí≥ –ù–ò–ñ–ù–Ø–Ø –°–ï–ö–¶–ò–Ø - –ö–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏**
  ///
  /// **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω:**
  /// - –í—Å–µ–≥–¥–∞ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
  /// - –£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ
  /// - –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫
  /// - –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏
  /// - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã —Å–Ω–∏–∑—É
  Widget _buildBottomSection() {
    return Column(
      mainAxisSize: MainAxisSize.min,
      children: [
        /// **–£—Å–ª–æ–≤–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ - –∫–æ–º–ø–∞–∫—Ç–Ω–æ**
        Text(
          'Ëá™Âä®Áª≠ËÆ¢ÔºåÂèØÈöèÊó∂ÂèñÊ∂à„ÄÇ\nÊù°Ê¨æÂíåÈöêÁßÅÊîøÁ≠ñ„ÄÇÊÅ¢Â§çË¥≠‰π∞',
          style: context.styles.mDemilight.copyWith(
            color: Colors.black,
            height: 1.4, // –£–º–µ–Ω—å—à–µ–Ω–∞ —Å 1.5 –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
          ),
          textAlign: TextAlign.center,
        ),
        SizedBox(height: 6.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 8.h
        /// **–ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫**
        TextButton(
          onPressed: () async {
            if (isPurchasing || isRestoring) return;

            // –•—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
            HapticFeedback.lightImpact();

            setState(() {
              isRestoring = true;
              purchaseStatusText = 'Ê≠£Âú®È™åËØÅÊÇ®ÁöÑË¥≠‰π∞ËÆ∞ÂΩï...';
            });

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏
            _pulseController.repeat(reverse: true);

            try {
              debugPrint('[PaywallBody] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–æ–∫');
              final success = await repository.restorePurchases();

              // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
              _pulseController.stop();

              if (success) {
                // –£—Å–ø–µ—Ö - —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫
                HapticFeedback.mediumImpact();

                setState(() {
                  isSuccess = true;
                  isRestoring = false;
                });
              } else {
                // –û—à–∏–±–∫–∞ - —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫
                HapticFeedback.heavyImpact();

                setState(() {
                  isRestoring = false;
                });
                if (mounted) {
                  ScaffoldMessenger.of(
                    context,
                  ).showSnackBar(const SnackBar(content: Text('Êú™ÊâæÂà∞ÂèØÊÅ¢Â§çÁöÑË¥≠‰π∞ËÆ∞ÂΩï')));
                }
              }
            } catch (e) {
              debugPrint('[PaywallBody] –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫: $e');

              // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –æ—à–∏–±–∫–∏
              _pulseController.stop();
              HapticFeedback.heavyImpact();

              setState(() {
                isRestoring = false;
              });
              if (mounted) {
                ScaffoldMessenger.of(
                  context,
                ).showSnackBar(const SnackBar(content: Text('ÊÅ¢Â§çË¥≠‰π∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï')));
              }
            }
          },
          child: Text(
            'ÊÅ¢Â§çË¥≠‰π∞',
            style: context.styles.mRegular.copyWith(
              color: isRestoring ? Colors.grey : const Color(0xFF6B73FF),
              decoration: TextDecoration.underline,
            ),
          ),
        ),
        SizedBox(height: 8.h), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 12.h
        /// **–û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏**
        Zbutton(
          action: () async {
            if (products.isEmpty || isPurchasing || isRestoring) return;

            // –•—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏
            HapticFeedback.lightImpact();

            setState(() {
              isPurchasing = true;
              purchaseStatusText = 'Ê≠£Âú®ËøûÊé•ÊîØ‰ªòÁ≥ªÁªü...';
            });

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏
            _pulseController.repeat(reverse: true);

            try {
              // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
              final selectedProduct = products[selectedPlanIndex];
              debugPrint(
                '[PaywallBody] –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞: ${selectedProduct.productId}',
              );

              // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
              setState(() {
                purchaseStatusText = 'Ê≠£Âú®Â§ÑÁêÜÊîØ‰ªò...';
              });

              // –ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ Adapty —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
              final success = await repository.purchaseSubscription(
                selectedProduct.productId,
              );

              // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
              _pulseController.stop();

              if (success) {
                // –£—Å–ø–µ—Ö - —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫
                HapticFeedback.mediumImpact();

                setState(() {
                  isSuccess = true;
                  isPurchasing = false;
                });
              } else {
                // –û—à–∏–±–∫–∞ - —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫
                HapticFeedback.heavyImpact();

                setState(() {
                  isPurchasing = false;
                });
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                if (mounted) {
                  ScaffoldMessenger.of(
                    context,
                  ).showSnackBar(const SnackBar(content: Text('Ë¥≠‰π∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï')));
                }
              }
            } catch (e) {
              debugPrint('[PaywallBody] –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏: $e');

              // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ —Ö—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –æ—à–∏–±–∫–∏
              _pulseController.stop();
              HapticFeedback.heavyImpact();

              setState(() {
                isPurchasing = false;
              });
              if (mounted) {
                ScaffoldMessenger.of(
                  context,
                ).showSnackBar(const SnackBar(content: Text('Ë¥≠‰π∞Â§±Ë¥•ÔºåËØ∑ÈáçËØï')));
              }
            }
          },
          isLoading: isPurchasing,
          isActive: products.isNotEmpty && !isPurchasing && !isRestoring,
          text: isPurchasing ? 'Â§ÑÁêÜ‰∏≠...' : 'Á´ãÂç≥Êõ¥Êñ∞',
          textColor: Colors.white,
        ),

        /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É**
        /// –ë–æ–ª—å—à–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, –º–µ–Ω—å—à–µ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö
        SizedBox(height: 12.h),
      ],
    );
  }

  /// **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ VIP - –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –í–ï–†–°–ò–Ø**
  ///
  /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
  /// - –£–º–µ–Ω—å—à–µ–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏–∫–æ–Ω–æ–∫ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
  /// - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
  /// - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
  List<Widget> _buildAdvantages() {
    List<String> texts = ['Êó†ÈôêÂç†Âçú', 'Êó†ÈôêÁöÑÊæÑÊ∏ÖÂíåÈóÆÈ¢ò', '‰øùÂ≠òÊâÄÊúâÁâåÂ±ÄÂú®ÂéÜÂè≤ËÆ∞ÂΩï‰∏≠'];
    return texts
        .map(
          (e) => Padding(
            padding: EdgeInsets.only(bottom: 6.h), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
            child: Row(
              children: [
                SvgPicture.asset(
                  'assets/crown.svg',
                  width: 14.w, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 16.w
                  height: 14.h, // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 16.h
                ),
                SizedBox(width: 10.w), // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 12.w
                Expanded(child: Text(e, style: context.styles.mDemilight)),
              ],
            ),
          ),
        )
        .toList();
  }

  /// **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–ª–∞–Ω–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏ - –ö–û–ú–ü–ê–ö–¢–ù–ê–Ø –í–ï–†–°–ò–Ø**
  ///
  /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
  /// - –£–º–µ–Ω—å—à–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏
  /// - –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
  /// - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞
  List<Widget> _buildPlans() {
    return products
        .asMap()
        .entries
        .map(
          (entry) => _PlanCard(
            product: entry.value,
            isSelected: selectedPlanIndex == entry.key,
            onTap:
                () => setState(() {
                  selectedPlanIndex = entry.key;
                }),
            needsBottomPadding: entry.key == products.length - 1,
            isDisabled: isPurchasing || isRestoring,
            hasDiscount: entry.value.isRecommended,
            isCompact: true, // –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
          ),
        )
        .toList();
  }
}

class _PlanCard extends StatelessWidget {
  const _PlanCard({
    required this.product,
    required this.isSelected,
    required this.onTap,
    required this.needsBottomPadding,
    required this.isDisabled,
    required this.hasDiscount,
    required this.isCompact,
  });

  final SubscriptionProduct product;
  final bool isSelected;
  final VoidCallback onTap;
  final bool needsBottomPadding;
  final bool isDisabled;
  final bool hasDiscount;
  final bool isCompact;

  @override
  Widget build(BuildContext context) {
    return Padding(
      /// **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏**
      /// –í –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –æ—Ç—Å—Ç—É–ø—ã –º–µ–Ω—å—à–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
      padding: EdgeInsets.only(
        bottom:
            !needsBottomPadding
                ? (isCompact
                    ? 6.h
                    : 10.h) // –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
                : 0,
      ),
      child: InkWell(
        onTap:
            isDisabled
                ? null
                : () {
                  // –•—ç–ø—Ç–∏–∫ —Ñ–∏–¥–±–µ–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–ª–∞–Ω–∞
                  HapticFeedback.selectionClick();
                  onTap();
                },
        borderRadius: BorderRadius.circular(
          isCompact ? 16.r : 20.r,
        ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —É–≥–ª—ã
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          width: double.infinity,
          decoration: BoxDecoration(
            color: isDisabled ? Colors.grey.shade100 : Colors.white,
            borderRadius: BorderRadius.circular(
              isCompact ? 16.r : 20.r,
            ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —É–≥–ª—ã
            border:
                isSelected
                    ? Border.all(color: const Color(0xFF6B73FF), width: 2)
                    : null,
            boxShadow:
                isSelected
                    ? [
                      BoxShadow(
                        color: const Color(0xFF6B73FF).withOpacity(0.2),
                        blurRadius: 8,
                        offset: const Offset(0, 2),
                      ),
                    ]
                    : null,
          ),
          child: Stack(
            clipBehavior: Clip.none,
            children: [
              // –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
              Padding(
                padding: EdgeInsets.symmetric(
                  horizontal:
                      isCompact
                          ? 12.w
                          : 16.w, // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
                  vertical:
                      isCompact ? 8.h : 12.h, // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
                ),
                child: Row(
                  children: [
                    // Checkbox/–∏–∫–æ–Ω–∫–∞ –≤—ã–±–æ—Ä–∞ - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                    AnimatedContainer(
                      duration: const Duration(milliseconds: 200),
                      width: isCompact ? 20.w : 24.w, // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                      height: isCompact ? 20.h : 24.h, // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                      decoration: BoxDecoration(
                        color:
                            isSelected
                                ? const Color(0xFF6B73FF)
                                : Colors.transparent,
                        border: Border.all(
                          color:
                              isSelected
                                  ? const Color(0xFF6B73FF)
                                  : (isDisabled
                                      ? Colors.grey.shade400
                                      : Colors.grey.shade300),
                          width: 2,
                        ),
                        borderRadius: BorderRadius.circular(
                          isCompact ? 4.r : 6.r,
                        ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —É–≥–ª—ã
                      ),
                      child:
                          isSelected
                              ? Icon(
                                Icons.check,
                                color: Colors.white,
                                size: isCompact ? 12 : 16, // –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∏–∫–æ–Ω–∫–∞
                              )
                              : null,
                    ),
                    SizedBox(
                      width: isCompact ? 12.w : 16.w,
                    ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –æ—Ç—Å—Ç—É–ø
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞–Ω–µ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [
                          Text(product.title, style: context.styles.mMedium),
                          SizedBox(
                            height: isCompact ? 2.h : 4.h,
                          ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –æ—Ç—Å—Ç—É–ø
                          Text(
                            product.description,
                            style: context.styles.sDemilight,
                          ),
                        ],
                      ),
                    ),

                    // –¶–µ–Ω–∞ - –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
                    Row(
                      children: [
                        if (hasDiscount && product.originalPrice != null) ...[
                          Text(
                            product.originalPrice!,
                            style: context.styles.mMedium.copyWith(
                              color: ZColors.grayDark,
                              decoration: TextDecoration.lineThrough,
                            ),
                          ),
                          SizedBox(width: 4.w),
                        ],
                        Text(product.price, style: context.styles.mMedium),
                      ],
                    ),
                  ],
                ),
              ),

              // –ö–Ω–æ–ø–∫–∞ —Å–∫–∏–¥–∫–∏ - –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
              if (hasDiscount)
                Positioned(
                  right: isCompact ? 120.w : 143.w, // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                  top: isCompact ? -10.h : -13.h, // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                  child: Container(
                    width: isCompact ? 45.w : 50.w, // –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —à–∏—Ä–∏–Ω–∞
                    height: isCompact ? 20.h : 25.h, // –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞
                    decoration: BoxDecoration(
                      color: const Color(0xFF6B73FF),
                      borderRadius: BorderRadius.circular(
                        isCompact ? 10.r : 12.r,
                      ), // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —É–≥–ª—ã
                    ),
                    child: Center(
                      child: Text(
                        'ÊäòÊâ£',
                        style: context.styles.sDemilight.copyWith(
                          color: Colors.white,
                          height: 1.h,
                          fontSize:
                              isCompact ? 11.sp : null, // –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç
                        ),
                      ),
                    ),
                  ),
                ),
            ],
          ),
        ),
      ),
    );
  }
}
